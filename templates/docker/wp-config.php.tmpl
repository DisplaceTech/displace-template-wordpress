<?php
/**
 * WordPress Configuration - {{.ProjectName}}
 *
 * This file is configured for Kubernetes deployment.
 * Database credentials are read from environment variables.
 */

// ** Database settings - from environment ** //
define('DB_NAME', getenv('WORDPRESS_DATABASE_NAME') ?: 'wordpress');
define('DB_USER', getenv('WORDPRESS_DATABASE_USER') ?: 'wordpress');
define('DB_PASSWORD', getenv('WORDPRESS_DATABASE_PASSWORD') ?: '');
define('DB_HOST', getenv('WORDPRESS_DATABASE_HOST') ?: 'localhost');
define('DB_CHARSET', 'utf8mb4');
define('DB_COLLATE', '');

// ** Authentication Unique Keys and Salts ** //
// Generate these at: https://api.wordpress.org/secret-key/1.1/salt/
define('AUTH_KEY',         getenv('WORDPRESS_AUTH_KEY') ?: '{{.AuthKey}}');
define('SECURE_AUTH_KEY',  getenv('WORDPRESS_SECURE_AUTH_KEY') ?: '{{.SecureAuthKey}}');
define('LOGGED_IN_KEY',    getenv('WORDPRESS_LOGGED_IN_KEY') ?: '{{.LoggedInKey}}');
define('NONCE_KEY',        getenv('WORDPRESS_NONCE_KEY') ?: '{{.NonceKey}}');
define('AUTH_SALT',        getenv('WORDPRESS_AUTH_SALT') ?: '{{.AuthSalt}}');
define('SECURE_AUTH_SALT', getenv('WORDPRESS_SECURE_AUTH_SALT') ?: '{{.SecureAuthSalt}}');
define('LOGGED_IN_SALT',   getenv('WORDPRESS_LOGGED_IN_SALT') ?: '{{.LoggedInSalt}}');
define('NONCE_SALT',       getenv('WORDPRESS_NONCE_SALT') ?: '{{.NonceSalt}}');

// ** Database Table prefix ** //
$table_prefix = getenv('WORDPRESS_TABLE_PREFIX') ?: 'wp_';

// ** WordPress URLs ** //
if (getenv('WORDPRESS_HOME')) {
    define('WP_HOME', getenv('WORDPRESS_HOME'));
}
if (getenv('WORDPRESS_SITEURL')) {
    define('WP_SITEURL', getenv('WORDPRESS_SITEURL'));
}

// ** SSL/HTTPS handling for reverse proxy ** //
if (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') {
    $_SERVER['HTTPS'] = 'on';
}

// Trust X-Forwarded-For header from proxy
if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {
    $forwarded_ips = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);
    $_SERVER['REMOTE_ADDR'] = trim($forwarded_ips[0]);
}

// ** Debug settings ** //
define('WP_DEBUG', filter_var(getenv('WORDPRESS_DEBUG') ?: false, FILTER_VALIDATE_BOOLEAN));
define('WP_DEBUG_LOG', filter_var(getenv('WORDPRESS_DEBUG_LOG') ?: false, FILTER_VALIDATE_BOOLEAN));
define('WP_DEBUG_DISPLAY', filter_var(getenv('WORDPRESS_DEBUG_DISPLAY') ?: false, FILTER_VALIDATE_BOOLEAN));

// ** Memory limits ** //
define('WP_MEMORY_LIMIT', getenv('WORDPRESS_MEMORY_LIMIT') ?: '256M');
define('WP_MAX_MEMORY_LIMIT', getenv('WORDPRESS_MAX_MEMORY_LIMIT') ?: '512M');

// ** Auto-updates - disabled for container deployments ** //
define('AUTOMATIC_UPDATER_DISABLED', true);
define('WP_AUTO_UPDATE_CORE', false);

// ** File editing - disabled for security ** //
define('DISALLOW_FILE_EDIT', true);

// ** Disable file modifications in production ** //
if (getenv('WORDPRESS_ENV') === 'production') {
    define('DISALLOW_FILE_MODS', true);
}

// ** Cron settings ** //
// For Kubernetes, consider using external cron jobs
if (getenv('DISABLE_WP_CRON')) {
    define('DISABLE_WP_CRON', true);
}

// ** Content directory (custom themes/plugins location) ** //
// This allows uploads to be on a separate PVC
define('WP_CONTENT_DIR', '/var/www/html/wp-content');
define('WP_CONTENT_URL', (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on' ? 'https' : 'http') . '://' . $_SERVER['HTTP_HOST'] . '/wp-content');

/* Add any custom values below this line. */

/* That's all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if (!defined('ABSPATH')) {
    define('ABSPATH', __DIR__ . '/');
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . 'wp-settings.php';
