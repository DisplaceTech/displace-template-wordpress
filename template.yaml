name: wordpress
version: "27.0.0"
description: Production-ready WordPress deployment for Kubernetes with build-from-source
author: Displace Technologies
license: Apache-2.0
homepage: https://github.com/DisplaceTech/displace-template-wordpress
repository: https://github.com/DisplaceTech/displace-template-wordpress

# Template configuration
template:
  type: kubernetes
  engine: go-template

  # Required variables
  variables:
    - name: ProjectName
      description: "Name of the WordPress project"
      required: true
      type: string
      pattern: "^[a-z][a-z0-9-]*[a-z0-9]$"
      example: "my-wordpress-site"

    - name: Namespace
      description: "Kubernetes namespace for deployment"
      required: true
      type: string
      default: "{{.ProjectName}}"
      pattern: "^[a-z][a-z0-9-]*[a-z0-9]$"

    - name: Domain
      description: "Domain name for the WordPress site"
      required: true
      type: string
      pattern: "^[a-zA-Z0-9][a-zA-Z0-9.-]*[a-zA-Z0-9]$"
      example: "blog.example.com"

    - name: DBRootPassword
      description: "MariaDB root password"
      required: true
      type: string
      sensitive: true

    - name: DBPassword
      description: "WordPress database password"
      required: true
      type: string
      sensitive: true

    - name: WordPressPassword
      description: "WordPress admin password"
      required: true
      type: string
      sensitive: true

    - name: DBRootPasswordB64
      description: "Base64 encoded MariaDB root password"
      required: true
      type: string
      computed: true

    - name: DBPasswordB64
      description: "Base64 encoded WordPress database password"
      required: true
      type: string
      computed: true

    # WordPress security keys (computed/generated)
    - name: AuthKey
      description: "WordPress AUTH_KEY"
      required: true
      type: string
      computed: true
      sensitive: true

    - name: SecureAuthKey
      description: "WordPress SECURE_AUTH_KEY"
      required: true
      type: string
      computed: true
      sensitive: true

    - name: LoggedInKey
      description: "WordPress LOGGED_IN_KEY"
      required: true
      type: string
      computed: true
      sensitive: true

    - name: NonceKey
      description: "WordPress NONCE_KEY"
      required: true
      type: string
      computed: true
      sensitive: true

    - name: AuthSalt
      description: "WordPress AUTH_SALT"
      required: true
      type: string
      computed: true
      sensitive: true

    - name: SecureAuthSalt
      description: "WordPress SECURE_AUTH_SALT"
      required: true
      type: string
      computed: true
      sensitive: true

    - name: LoggedInSalt
      description: "WordPress LOGGED_IN_SALT"
      required: true
      type: string
      computed: true
      sensitive: true

    - name: NonceSalt
      description: "WordPress NONCE_SALT"
      required: true
      type: string
      computed: true
      sensitive: true

  # Optional variables with defaults
  optional_variables:
    - name: ProjectDisplayName
      description: "Human-readable project display name"
      type: string
      default: "{{.ProjectName}}"
      example: "My WordPress Site"

    - name: PHPVersion
      description: "PHP version for WordPress"
      type: string
      default: "8.3"
      pattern: "^8\\.[0-9]+$"
      example: "8.2"

    - name: WordPressVersion
      description: "WordPress version to install"
      type: string
      default: "6.7.1"
      pattern: "^[0-9]+\\.[0-9]+\\.?[0-9]*$"
      example: "6.6.2"

    - name: WordPressReplicas
      description: "Number of WordPress pod replicas"
      type: integer
      default: 1
      minimum: 1
      maximum: 10

    - name: WordPressStorageSize
      description: "Size of WordPress uploads storage"
      type: string
      default: "10Gi"
      pattern: "^[0-9]+[KMGT]i?$"
      example: "20Gi"

    - name: MariaDBStorageSize
      description: "Size of MariaDB data storage"
      type: string
      default: "8Gi"
      pattern: "^[0-9]+[KMGT]i?$"
      example: "16Gi"

    - name: IngressClass
      description: "Ingress controller class"
      type: string
      default: "nginx"
      example: "traefik"

    - name: CertIssuer
      description: "Cert-manager cluster issuer"
      type: string
      default: "letsencrypt-prod"
      example: "letsencrypt-staging"

    - name: RegistryURL
      description: "Container registry URL for built images"
      type: string
      default: ""
      example: "ghcr.io/myorg"

    - name: MemoryLimit
      description: "Container memory limit"
      type: string
      default: "512Mi"
      pattern: "^[0-9]+[KMGT]i?$"
      example: "1Gi"

    - name: CPULimit
      description: "Container CPU limit"
      type: string
      default: "500m"
      pattern: "^[0-9]+m?$"
      example: "1000m"

# Template file mappings
files:
  - source: "templates/.gitignore.tmpl"
    destination: ".gitignore"

  - source: "templates/.credentials.tmpl"
    destination: ".credentials"
    permissions: "0600"

  - source: "templates/Makefile.tmpl"
    destination: "Makefile"

  - source: "templates/README.md.tmpl"
    destination: "README.md"

  - source: "templates/Dockerfile.tmpl"
    destination: "Dockerfile"

  - source: "templates/docker-compose.yaml.tmpl"
    destination: "docker-compose.yaml"

  - source: "templates/docker/nginx.conf.tmpl"
    destination: "docker/nginx.conf"

  - source: "templates/docker/supervisord.conf.tmpl"
    destination: "docker/supervisord.conf"

  - source: "templates/docker/wp-config.php.tmpl"
    destination: "docker/wp-config.php"

  - source: "templates/themes/.gitkeep.tmpl"
    destination: "themes/.gitkeep"

  - source: "templates/plugins/.gitkeep.tmpl"
    destination: "plugins/.gitkeep"

  - source: "templates/mu-plugins/.gitkeep.tmpl"
    destination: "mu-plugins/.gitkeep"

  - source: "templates/uploads/.gitkeep.tmpl"
    destination: "uploads/.gitkeep"

  - source: "templates/manifests/01-namespace.yaml.tmpl"
    destination: "manifests/01-namespace.yaml"

  - source: "templates/manifests/02-database-secret.yaml.tmpl"
    destination: "manifests/02-database-secret.yaml"

  - source: "templates/manifests/03-mariadb.yaml.tmpl"
    destination: "manifests/03-mariadb.yaml"

  - source: "templates/manifests/04-wordpress.yaml.tmpl"
    destination: "manifests/04-wordpress.yaml"

  - source: "templates/manifests/05-ingress.yaml.tmpl"
    destination: "manifests/05-ingress.yaml"

  - source: "templates/secrets/database-secret-override.yaml.tmpl"
    destination: "manifests/secrets/database-secret-override.yaml"
    permissions: "0600"

# Build configuration
build:
  dockerfile: "Dockerfile"
  context: "."
  args:
    PHP_VERSION: "{{.PHPVersion}}"
    WORDPRESS_VERSION: "{{.WordPressVersion}}"

  # Image naming
  image_name: "{{.ProjectName}}"
  image_tag: "latest"

# Template features and capabilities
features:
  - kubernetes
  - wordpress
  - mariadb
  - persistent-storage
  - https
  - database-backup
  - build-from-source
  - dev-mode
  - hot-reload

categories:
  - web
  - cms
  - kubernetes

tags:
  - wordpress
  - mariadb
  - kubernetes
  - php
  - nginx
  - https
  - pvc
  - docker-build

# System requirements
requirements:
  kubernetes: ">=1.20"
  docker: ">=20.10"
  tools:
    - docker
  optional_tools:
    - kubectl
    - displace

# Template structure validation
structure:
  templates_dir: "templates"

  required_files:
    - "templates/Makefile.tmpl"
    - "templates/README.md.tmpl"
    - "templates/Dockerfile.tmpl"
    - "templates/manifests/01-namespace.yaml.tmpl"
    - "templates/manifests/03-mariadb.yaml.tmpl"
    - "templates/manifests/04-wordpress.yaml.tmpl"

# Post-generation instructions
post_generation:
  message: |
    WordPress project created successfully!

    Project Structure:
      themes/     - Custom WordPress themes (vendored into image)
      plugins/    - Custom WordPress plugins (vendored into image)
      mu-plugins/ - Must-use plugins (auto-activated)
      uploads/    - Persistent storage (PVC in production)

    Getting Started:
      1. Add custom themes to ./themes/ directory
      2. Add custom plugins to ./plugins/ directory
      3. Build the image: make build
      4. Deploy to Kubernetes: make deploy

    Development Mode:
      make dev          - Start local dev environment with hot-reload
      make dev-logs     - View container logs
      make dev-down     - Stop dev environment

    Configuration:
      - PHP Version: {{.PHPVersion}}
      - WordPress Version: {{.WordPressVersion}}
      - Credentials stored in .credentials (excluded from git)

    For detailed documentation, see README.md

  commands:
    - description: "Start development environment"
      command: "make dev"
    - description: "Build Docker image"
      command: "make build"
    - description: "Deploy WordPress to Kubernetes"
      command: "make deploy"
    - description: "Check deployment status"
      command: "make status"
    - description: "Access WordPress locally"
      command: "make port-forward"
    - description: "Backup database"
      command: "make backup-db"

# Attribution information
attribution:
  original_work: "WordPress Official Docker Image"
  original_url: "https://hub.docker.com/_/wordpress"
  original_license: "GPLv2"
  modifications: "Custom build-from-source template for Displace CLI"
